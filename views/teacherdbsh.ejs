<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard</title>
    <link rel="stylesheet" href="teacherstyle.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"/>
      <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
</head>
<body>
    <div class="staffroom">
        <header>
            
            <nav class="navigation">
            <a href="/" class="logo"><img src="images/newlogo6.png" /></a>
              <a href="/">Home</a>
              <a href="#">About</a>
              <a href="#">Contact</a>
              <a href="#" onclick="submitForm()">Logout</a>
        

            </nav>
          </header>
          <h2 id="text">Welcome To Staffroom</h2>

      <section class="parallax">
       
   
      </section>

    </div>
    <div class="function">
      
      <main class="main px-3">
        
        <div class="intro">
          <h1 class="text-dark"  data-aos="zoom-in">Hello <%= name %>
          </h1>
          <p class="lead text-dark"   data-aos="zoom-in">Welcome to Teacher Dashboard</p>
        </div>
        
        <div class="entry">
          <img src="images/time.png" class="hand"   data-aos="slide-right">
          <div class="info" data-aos="zoom-in">
            <form method="POST" action="/dashboard" class="form-control" id="findSubsForm">
              <label for="day">Day:</label>
              <select id="day" name="day">
                <!-- Options for days -->
                <option value="mon">Monday</option>
              <option value="tue">Tuesday</option>
              <option value="wed">Wednesday</option>
              <option value="thu">Thursday</option>
              <option value="fri">Friday</option>
              </select><br /><br />
            
              <label for="timeSlot">Timeslot:</label>
              <select id="timeSlot" name="timeSlot">
                <!-- Options for timeslots -->
                <option value="9-10 AM">9-10 AM</option>
              <option value="10-11 AM">10-11 AM</option>
              <option value="11:30-12:30 PM">11:30-12:30 PM</option>
              <option value="12:30-1:30 PM">12:30-1:30 PM</option>
              <option value="2:15-4:15 PM">2:15-4:15 PM</option>
              </select><br /><br />
            
              <button type="submit" class="btn btn-dark" id="findSubstitutionsBtn">Find Substitutions</button>
            </form>
           
        </div>
        <img src="images/dhamankar.png" class="dha "  data-aos="slide-left"></div>
          
      
        
       
        
        
      </main>
     
   
    </div>
    <div class="tetable"  ">
      <% const currentDate=new Date(); %> 
        <% const options={ weekday: 'long'}; %> 
        <% var currentDay=currentDate.toLocaleDateString('en-US',options).substring(0,3).toLowerCase(); %> 
        <% if((currentDay ==="sun")||(currentDay==="sat")) { %>
          <% currentDay = "mon"; %>
        <% } %>

          <% const currentDay2=currentDate.toLocaleDateString('en-US',options); %>
          <% if((currentDay2 ==="Sunday")||(currentDay2 ==="Saturday")) { %>
            <% currentDay = "mon"; %>
          <% } %>
            <table class="timetable table-dark w-75 mx-auto table-bordered "data-aos="zoom-in"">
              <tr>
                <th colspan="2" class="text-center">
                  <%= currentDay2 %>
                </th>
              </tr>
              <tr class="text-center">
                <th class="time text-center text-justify">Time Slot</th>
                <th class="sub text-center">Lecture</th>
              </tr>
              <% Object.keys(timetable[currentDay]).forEach((timeSlot)=> { %>
                <tr>
                  <td>
                    <%= timeSlot %>
                  </td>
                  <td>
                    <%= timetable[currentDay][timeSlot] %>
                  </td>
                </tr>
                <% }) %>
            </table>

   

    </div>

      <!-- Modal -->
  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Available Teachers</h4>
        </div>
        <div class="modal-body">
          <form action="/modalForm" method="POST" class="row">
            <div class="col-auto">
              <div class="form-group">
                <label for="inlineFormCustomSelect">Preference</label>
                <select class="custom-select" id="inlineFormCustomSelect" name="inlineFormCustomSelect">
                  <option selected>Choose...</option>
                  <!-- Options populated dynamically based on modalData -->
                </select>
              </div>
            </div>
            <div class="col-auto">
              <button type="submit" class="btn btn-primary">Submit</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
    
  <form action="/logout?_method=DELETE" method="POST" style="display:none; "id="myForm">
    <button class="nav-link fw-bold py-1 px-0 btn p=3 btn-dark text-white" type="submit"  >Logout</button>

  </form>
  
  <footer class="mt-auto text-dark-50">
    <p class="text-dark">
      EduSync <a href="" class="text-dark">Copyright</a>
    </p>
  </footer>

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>

  <script>
    function submitForm() {
      // Get the form element
      var form = document.getElementById("myForm");
      // Submit the form
      form.submit();
    }
  </script>
  
  <script>
    // Event listener for form submission
    document.getElementById("findSubsForm").addEventListener("submit", function(event) {
      event.preventDefault(); // Prevent form submission
      // Get the selected day and timeslot
      var dayInput = document.getElementById("day").value;
      var timeslotInput = document.getElementById("timeSlot").value;
      // Fetch modal data dynamically based on dayInput and timeslotInput
      fetchModalData(dayInput, timeslotInput)
        .then(function(modalData) {
          // Update the modal options dynamically
          var selectElement = document.getElementById("inlineFormCustomSelect");
          selectElement.innerHTML = "";
          if (modalData != null) {
            modalData.forEach(function(ob) {
              var option = document.createElement("option");
              option.value = ob.name;
              option.text = ob.name;
              selectElement.appendChild(option);
            });
          }
          // Display the modal
          $('#myModal').modal('show');
        })
        .catch(function(error) {
          console.log(error);
        });
    });
    // Function to fetch modal data from the backend
    async function fetchModalData(dayInput, timeslotInput) {
      try {
        const response = await fetch('/dashboard', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ day: dayInput, timeSlot: timeslotInput })
        });
        const data = await response.json();
        if (response.ok) {
          return data.modalData;
        } else {
          throw new Error(data.error);
        }
      } catch (error) {
        console.log(error);
        return null;
      }
    }
  </script>
  <script src="script.js"></script>
  <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
  <script>
    AOS.init({
        offset: 85,
        duration: 1000,
    });
  </script>


</body>
</html>


